name: Import Backlog Issues

on:
  push:
    paths:
      - ".github/backlog.y*ml"

jobs:
  import-backlog:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install yq
        run: sudo apt-get update && sudo apt-get install -y yq

      - name: Import backlog into Issues
        run: |
          echo "Importing backlog..."
          while IFS= read -r issue; do
            gh issue create --title "$(yq e '.title' <<< "$issue")" \
                            --body  "$(yq e '.body'  <<< "$issue")" \
                            --label "$(yq e '.labels[]' <<< "$issue" | xargs)" \
                            --milestone "$(yq e '.milestone' <<< "$issue")" || true
          done < <(yq e -o=json -I=0 '.[]' .github/backlog.y*ml)
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
